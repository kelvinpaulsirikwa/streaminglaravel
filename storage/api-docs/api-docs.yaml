openapi: 3.0.0
info:
  title: Rashid Backend API Documentation
  description: Complete API Documentation for Rashid Backend Application
  version: 1.0.0
  contact:
    email: admin@rashid.com
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
servers:
  - url: http://127.0.0.1:8000
    description: Rashid Backend API Server

tags:
  - name: User Authentication
    description: User authentication endpoints
  - name: User Subscriptions
    description: User subscription management
  - name: User Chat
    description: User chat functionality
  - name: User Payments
    description: User payment processing
  - name: User Payment History
    description: User payment history and details
  - name: Superstar Authentication
    description: Superstar authentication endpoints
  - name: Superstar Profile
    description: Superstar profile management
  - name: Superstar Payments
    description: Superstar payment management

paths:
  # User Authentication
  /api/user/google-login:
    post:
      tags:
        - User Authentication
      summary: Google OAuth Login
      description: This endpoint handles Google OAuth login by checking if the email exists, updating or creating user data, and returning user data with Sanctum token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - username
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                username:
                  type: string
                  example: johndoe
                image:
                  type: string
                  nullable: true
                  example: https://example.com/avatar.jpg
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
                  user:
                    type: object
                  token:
                    type: string
        '422':
          description: Validation error

  # User Subscriptions
  /api/user/subscriptions:
    get:
      tags:
        - User Subscriptions
      summary: Get user subscriptions
      description: Get authenticated user's subscriptions with pagination. Returns superstars with their details
      security:
        - sanctum: []
      parameters:
        - name: per_page
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            default: 15
      responses:
        '200':
          description: Subscriptions retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object
        '401':
          description: Unauthorized

    post:
      tags:
        - User Subscriptions
      summary: Subscribe to superstar
      description: Subscribe to a superstar and increases total_followers count
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - superstar_id
              properties:
                superstar_id:
                  type: integer
                  example: 1
      responses:
        '200':
          description: Subscription successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Subscribed successfully
        '401':
          description: Unauthorized
        '422':
          description: Validation error

  /api/user/subscriptions/{superstarId}:
    delete:
      tags:
        - User Subscriptions
      summary: Unsubscribe from superstar
      description: Unsubscribe from a superstar and decreases total_followers count
      security:
        - sanctum: []
      parameters:
        - name: superstarId
          in: path
          description: Superstar ID to unsubscribe from
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Unsubscription successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Unsubscribed successfully
        '401':
          description: Unauthorized
        '404':
          description: Subscription not found

  # User Chat
  /api/user/chat/start/{superstarId}:
    post:
      tags:
        - User Chat
      summary: Start chat with superstar
      description: Find or create conversation with a superstar
      security:
        - sanctum: []
      parameters:
        - name: superstarId
          in: path
          description: Superstar ID to start chat with
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Chat started successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Chat started successfully
                  conversation:
                    type: object
        '401':
          description: Unauthorized
        '404':
          description: Superstar not found

  /api/user/chat/conversations:
    get:
      tags:
        - User Chat
      summary: Get user conversations
      description: Get all conversations for the authenticated user
      security:
        - sanctum: []
      responses:
        '200':
          description: Conversations retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversations:
                    type: array
                    items:
                      type: object
        '401':
          description: Unauthorized

  /api/user/chat/unread-count:
    get:
      tags:
        - User Chat
      summary: Get unread message count
      description: Get count of unread messages for the authenticated user
      security:
        - sanctum: []
      responses:
        '200':
          description: Unread count retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  unread_count:
                    type: integer
                    example: 5
        '401':
          description: Unauthorized

  # User Payments
  /api/user/payments/process:
    post:
      tags:
        - User Payments
      summary: Process payment
      description: Process payment for chat session and create payment records
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - conversation_id
                - payment_method
                - amount
              properties:
                conversation_id:
                  type: integer
                  example: 1
                payment_method:
                  type: string
                  enum:
                    - wallet
                    - card
                    - mobile_money
                  example: card
                amount:
                  type: number
                  format: float
                  example: 50.00
      responses:
        '200':
          description: Payment processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Payment processed successfully
                  payment:
                    type: object
        '422':
          description: Validation error

  /api/user/payments/history:
    get:
      tags:
        - User Payments
      summary: Get payment history
      description: Get user's payment history with pagination
      security:
        - sanctum: []
      parameters:
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 15
      responses:
        '200':
          description: Payment history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  payments:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object

  # User Payment History
  /api/user/payment-history/user:
    get:
      tags:
        - User Payment History
      summary: Get all user payments
      description: Fetch all user payments with pagination
      security:
        - sanctum: []
      parameters:
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 15
      responses:
        '200':
          description: Payments retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  payments:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object

  /api/user/payment-history/superstar/{superstarId}:
    get:
      tags:
        - User Payment History
      summary: Get payments by superstar
      description: Fetch payments filtered by specific superstar with pagination
      security:
        - sanctum: []
      parameters:
        - name: superstarId
          in: path
          description: Superstar ID
          required: true
          schema:
            type: integer
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 15
      responses:
        '200':
          description: Payments retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  superstar:
                    type: object
                  payments:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object

  /api/user/payment-history/transaction/{transactionReference}:
    get:
      tags:
        - User Payment History
      summary: Get transaction details
      description: View complete transaction details by reference
      security:
        - sanctum: []
      parameters:
        - name: transactionReference
          in: path
          description: Transaction reference
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Transaction details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  transaction:
                    type: object
        '404':
          description: Transaction not found

  # Superstar Authentication
  /api/superstar/login:
    post:
      tags:
        - Superstar Authentication
      summary: Superstar Login
      description: Login endpoint for superstars using email or username
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - login
                - password
              properties:
                login:
                  type: string
                  description: Email or username
                  example: superstar@example.com
                password:
                  type: string
                  format: password
                  example: password123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
                  superstar:
                    type: object
                  token:
                    type: string
        '401':
          description: Invalid credentials
        '422':
          description: Validation error

  /api/superstar/logout:
    post:
      tags:
        - Superstar Authentication
      summary: Logout superstar
      description: Logout the authenticated superstar and revoke token
      security:
        - sanctum: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully
        '401':
          description: Unauthorized

  /api/superstar/me:
    get:
      tags:
        - Superstar Authentication
      summary: Get authenticated superstar
      description: Get the authenticated superstar's profile information
      security:
        - sanctum: []
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  superstar:
                    type: object
        '401':
          description: Unauthorized

  # Superstar Profile
  /api/superstar/profile:
    put:
      tags:
        - Superstar Profile
      summary: Update superstar profile
      description: Update the authenticated superstar's profile information
      security:
        - sanctum: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                display_name:
                  type: string
                  example: John Doe
                bio:
                  type: string
                  example: Professional superstar
                price_per_hour:
                  type: number
                  format: float
                  example: 50.00
                is_available:
                  type: boolean
                  example: true
                username:
                  type: string
                  example: johndoe
                email:
                  type: string
                  format: email
                  example: john@example.com
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Profile updated successfully
                  superstar:
                    type: object
        '422':
          description: Validation error

  /api/superstar/change-password:
    post:
      tags:
        - Superstar Authentication
      summary: Change superstar password
      description: Change the authenticated superstar's password
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - current_password
                - password
              properties:
                current_password:
                  type: string
                  format: password
                password:
                  type: string
                  format: password
                  minLength: 8
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password changed successfully
        '422':
          description: Validation error

  # Superstar Payments
  /api/superstar/payments/history:
    get:
      tags:
        - Superstar Payments
      summary: Get superstar payment history
      description: Fetch superstar's own payment history with pagination
      security:
        - sanctum: []
      parameters:
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 15
      responses:
        '200':
          description: Payment history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  payments:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object

  /api/superstar/payments/system-revenue:
    get:
      tags:
        - Superstar Payments
      summary: Get system revenue
      description: Show system revenue (20% of all payments) with breakdown
      security:
        - sanctum: []
      parameters:
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 15
      responses:
        '200':
          description: System revenue retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  revenue_summary:
                    type: object
                  breakdowns:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object

  /api/superstar/payments/user/{userId}:
    get:
      tags:
        - Superstar Payments
      summary: Get user payment history
      description: View payment history for specific user with pagination
      security:
        - sanctum: []
      parameters:
        - name: userId
          in: path
          description: User ID
          required: true
          schema:
            type: integer
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 15
      responses:
        '200':
          description: User payment history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                  payments:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object
        '404':
          description: User not found

components:
  securitySchemes:
    sanctum:
      type: apiKey
      in: header
      name: Authorization
      description: Enter token in format (Bearer <token>)
